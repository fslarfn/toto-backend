<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - ERP TOTO ALUMINIUM MANUFACTURE</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    /* === FLUID BACKGROUND EFFECT === */
    .fluid-bg {
      background: linear-gradient(135deg, #A67B5B, #D2B48C);
      clip-path: polygon(0 0, 100% 0, 100% 75%, 0 100%);
      animation: slideInLeft 1s ease;
    }
    /* Animasi Masuk */
    @keyframes slideInLeft {
      0% { transform: translateX(-100%); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideInRight {
      0% { transform: translateX(100%); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }
    .login-box {
      animation: slideInRight 1s ease;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col lg:flex-row bg-[#F5EBDD]">

  <!-- ============================= -->
  <!-- BAGIAN KIRI - BRANDING -->
  <!-- ============================= -->
  <div class="fluid-bg hidden lg:flex lg:w-1/2 text-white items-center justify-center px-12">
    <div class="max-w-lg text-center">
      <h1 class="text-4xl lg:text-5xl font-extrabold mb-6 leading-tight">
        ERP TOTO
      </h1>
      <p class="text-lg opacity-90">
        Aplikasi berbasis web yang dibuat custom mengikuti kebutuhan CV TOTO ALUMINIUM MANUFACTURE.
      </p>
    </div>
  </div>

  <!-- ============================= -->
  <!-- BAGIAN KANAN - FORM LOGIN -->
  <!-- ============================= -->
  <div class="w-full lg:w-1/2 flex items-center justify-center p-8">
    <div class="login-box w-full max-w-md bg-white p-8 rounded-2xl shadow-2xl">
      <div class="mb-8 text-center">
        <h2 class="text-2xl font-bold text-[#5C4033]">Selamat Datang</h2>
        <p class="text-gray-500 text-sm mt-1">Masuk untuk mengakses sistem ERP</p>
      </div>
      <form id="login-form">
        <div class="mb-5">
          <label for="username" class="block text-sm font-medium text-[#5C4033] mb-2">Username</label>
          <input type="text" id="username" name="username" class="w-full px-4 py-3 border border-[#D2B48C] rounded-md focus:outline-none focus:ring-2 focus:ring-[#A67B5B] transition" required>
        </div>
        <div class="mb-6">
          <label for="password" class="block text-sm font-medium text-[#5C4033] mb-2">Password</label>
          <input type="password" id="password" name="password" class="w-full px-4 py-3 border border-[#D2B48C] rounded-md focus:outline-none focus:ring-2 focus:ring-[#A67B5B] transition" required>
        </div>
        <div id="login-error" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-md mb-4 text-sm" role="alert"></div>
        <button type="submit" class="w-full bg-[#A67B5B] text-white py-3 rounded-md font-semibold hover:bg-[#8B5E34] transition">
          Login
        </button>
      </form>
      <p class="mt-6 text-center text-sm text-gray-400">
        Â© 2025 CV Toto Aluminium Manufacture
      </p>
    </div>
  </div>

  <script>
  const form = document.getElementById('login-form');
  const errorBox = document.getElementById('login-error');

  const baseUrl = window.location.hostname === 'localhost'
    ? 'http://localhost:5000'
    : 'https://erptoto.up.railway.app';

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    errorBox.classList.add('hidden');

    try {
      const res = await fetch(`${baseUrl}/api/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });

      const data = await res.json();

      // ðŸ’¡ Tangani user dengan langganan nonaktif
      if (res.status === 403 && data.message.includes('Langganan terhenti')) {
        Swal.fire({
          icon: 'warning',
          title: 'Langganan Ditangguhkan',
          html: data.message.replace(/\n/g, '<br>'),
          confirmButtonText: 'Bayar Sekarang',
          confirmButtonColor: '#A67B5B'
        }).then(() => {
          window.open('https://lynk.id/rerelie/dol3n5710m79/checkout', '_blank');
        });
        return;
      }

      if (!res.ok) {
        errorBox.textContent = data.message || 'Username atau password salah';
        errorBox.classList.remove('hidden');
        return;
      }

      // âœ… Login sukses
      localStorage.setItem('authToken', data.token);
      localStorage.setItem('userData', JSON.stringify(data.user));
      window.location.href = 'dashboard.html';

    } catch (err) {
      console.error('Login error:', err);
      Swal.fire({
        icon: 'error',
        title: 'Kesalahan Server',
        text: 'Terjadi kesalahan koneksi ke server. Coba lagi nanti.',
      });
    }
  });
</script>

</body>
</html>
